function isValidDottedPath(e){return null!=e&&""!==e&&"hasOwnProperty"!==e&&MEMBER_NAME_REGEX.test("."+e)}function lookupDottedPath(e,t){if(!isValidDottedPath(t))throw $resourceMinErr("badmember",'Dotted member path "@{0}" is invalid.',t);for(var l=t.split("."),a=0,n=l.length;n>a&&void 0!==e;a++){var o=l[a];e=null!==e?e[o]:void 0}return e}function shallowClearAndCopy(e,t){t=t||{},angular.forEach(t,function(e,l){delete t[l]});for(var l in e)e.hasOwnProperty(l)&&"$"!==l.charAt(0)&&"$"!==l.charAt(1)&&(t[l]=e[l]);return t}app.constant("HOST","http://example.com:9004").constant("API_END_POINT","http://example.com:9004/api/").constant("SOURCE_URL","http://agent.example.com/").constant("MOBILE_DESIGN_URL","http://mviews.example.com:4002").constant("WEB_DESIGN_URL","http://views.example.com:4000").constant("WEBSITE_URL","http://example.com:9006/").config(["$sceProvider","$sceDelegateProvider","$httpProvider","SOURCE_URL","API_END_POINT",function(e,t,l,a,n){e.enabled(!1),t.resourceUrlWhitelist(["self",n+"**",a+"**"]),t.resourceUrlBlacklist([]),l.defaults.withCredentials=!0}]),app.run(["$rootScope","HOST","API_END_POINT","SOURCE_URL","WEB_DESIGN_URL","WEBSITE_URL","MOBILE_DESIGN_URL",function(e,t,l,a,n,o,r){e.HOST=t,e.API_END_POINT=l,e.SOURCE_URL=a,e.WEB_DESIGN_URL=n,e.WEBSITE_URL=o,e.MOBILE_DESIGN_URL=r}]),app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"modules/MainPage/views/main.html"})}]),app.controller("IndexCtrl",["$scope",function(){}]),app.config(["$routeProvider",function(e){e.when("/gallery_list",{templateUrl:"modules/Upload/views/gallery_v2.html"})}]),app.controller("GalleryCtrl",["$scope","$rootScope",function(e){e.roleList2=[{roleName:"User",roleId:"role1",collapsed:!0,children:[{roleName:"subUser1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subUser2",roleId:"role12",collapsed:!0,children:[{roleName:"subUser2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subUser2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subUser2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]},{roleName:"Admin",roleId:"role2",collapsed:!0,children:[{roleName:"subAdmin1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subAdmin2",roleId:"role12",collapsed:!0,children:[{roleName:"subAdmin2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subAdmin2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subAdmin2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]},{roleName:"Guest",roleId:"role3",collapsed:!0,children:[{roleName:"subGuest1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subGuest2",roleId:"role12",collapsed:!0,children:[{roleName:"subGuest2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subGuest2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subGuest2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]}]}]),app.config(["$httpProvider","fileUploadProvider","API_END_POINT",function(e,t,l){angular.extend(t.defaults,{disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:5e6,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|swf|flv)$/i,xhrFields:{withCredentials:!0},url:l+"upload"}),"undefined"!=typeof window.UEDITOR_CONFIG&&(window.UEDITOR_CONFIG.imageUrl=l+"upload",window.UEDITOR_CONFIG.imageManagerUrl=l+"album/Album_00000000000000000000000830/att")}]);var pic_resize=function(e,t){var e=e?e:"upload/system/nopic.jpg",l=e.lastIndexOf("."),a=e.substring(l,e.length);return e.substring(0,l)+"_"+t+a};app.controller("FileUploadCtrl",["$scope","$rootScope","$http","API_END_POINT","AlbumFactory","PictureFactory","$modal",function(e,t,l,a,n,o,r){var i=[{name:"album_id",value:e.albumId}];e.thumb_size={width:80,height:80},e.API_END_POINT=a,e.cateName="",e.searchText="",e.loadingFiles=!0,e.albumId=e.albumId||null,e.page=1,e.pageSize=18,e.pageList=[],e.pageNum=[],e.maxPage=0,e.cur_cate_list=[],e.history=[null],e.breakNav=[],e.temp=null,e.checkboxList=[],e.checkAllFn=function(){e.checkAll=!e.checkAll},e.upload_opts={autoUpload:!0,formData:i,done:function(t,l){setTimeout(function(){l.result[0].thumbnail_path=l.result[0].server_path,e.pageList.unshift(l.result[0]),e.folderReFresh()},1e3)}},e.preUpload=function(){e.albumId||e.folderInto(e.album_list[0].album_id)},e.get_pic=function(t){e.albumId=t,i[0].value=t,o.query(t).then(function(t){e.pic_list=t,e.pagination(t,e.page,e.pageSize)})},e.select_pic=function(t){e.select_list.push(t),e.ok()},e.pic_delete=function(l,a,n){t.open("是否删除该图片？",function(){o.del(e.albumId,l.att_id).then(function(){e.pageList.splice(a,1)})},{ok:"确定",cancel:"取消"}),n.stopPropagation()},e.pic_delete_all=function(){0!==e.checkboxList.length&&t.open("是否删除选中的图片？",function(){o.del(e.checkboxList).then(function(){e.folderReFresh(),e.checkboxList.length=0})},{ok:"确定",cancel:"取消"})},n.query().then(function(t){if(e.album_list=t.data,e.cate_list=e.cur_cate_list=Est.bulidTreeNode(t.data,"parent_id",null,{categoryId:"album_id",belongId:"parent_id",childTag:"children"}),0===e.cate_list.length){var l=$q.defer();return c("默认相册",e.albumId),c("产品图片相册",e.albumId),c("网站装修相册",e.albumId),l.promise}e.albumId&&e.folderInto(e.albumId)}),e.cleanFolder=function(){e.pageList=[],e.cur_cate_list=[]},e.folderInto=function(t){e.cleanFolder(),e.albumId=t,e.history.push(t),e.cur_cate_list=Est.filter(e.album_list,{parent_id:t}),e.get_pic(t),e.breakNav=Est.bulidBreakNav(e.album_list,"album_id",t,"name","parent_id")},e.folderBack=function(){1!==e.history.length&&(e.cleanFolder(),e.history.pop(),e.albumId=e.history[e.history.length-1],e.breakNav=Est.bulidBreakNav(e.album_list,"album_id",e.albumId,"name","parent_id"),e.cur_cate_list=Est.filter(e.album_list,{parent_id:e.albumId}),e.get_pic(e.albumId))},e.folderReFresh=function(){e.cleanFolder(),e.refleshAlbum(),e.get_pic(e.albumId)},e.refleshAlbum=function(){n.query().then(function(t){e.album_list=t.data,e.cate_list=Est.bulidTreeNode(t.data,"parent_id",null,{categoryId:"album_id",belongId:"parent_id",childTag:"children"}),e.cur_cate_list=Est.filter(e.album_list,{parent_id:e.albumId})})};var c=function(t,l){n.save({name:t,parent_id:l}).then(function(t){e.cate_list.push(t)})};e.add_cate=function(){e.cateName&&0!=e.cateName.length&&c(e.cateName,e.albumId)},e.cate_edit=function(t){return e.temp&&(e.temp.edit_show=!1),e.temp=t,t.edit_show=!0},e.cate_edit_save=function(l){return l&&l.name!==e.temp.name&&n.save(l).then(function(){t.showMsg("修改成功！")}),l.edit_show=!1},e.pic_edit=function(t){return e.temp&&(e.temp.edit_show=!1),e.temp=t,t.edit_show=!0},e.pic_edit_save=function(l){return l&&l.filename!==e.temp.filename&&o.save(e.albumId,l).then(function(){t.showMsg("修改成功！")}),l.edit_show=!1},e.pictureReplace=function(l){l.album_id=e.albumId;var a=r.open({templateUrl:"modules/Upload/views/picture_replace.html",resolve:{pic:function(){return l}},controller:["$scope","$modalInstance","pic",function(e,l,a){var n=[{name:"album_id",value:a.album_id},{name:"att_id",value:a.att_id}];e.upload_opts={autoUpload:!0,formData:n,done:function(t,l){l.result[0].thumbnail_path=l.result[0].server_path+"?id="+Est.nextUid(),a=l.result[0],e.ok()}},e.pic=a,t.modalInit(e,l,e.pic)}]});a.result.then(function(l){t.showMsg("替换成功"),setTimeout(function(){e.pic_list.push(l),e.folderReFresh()},1e3)})},e.cate_delete=function(l){t.open("删除该分类会将这个分类下所有的文件全部删除，是否继续？",function(){n.del(l).then(function(){e.folderReFresh()})},{ok:"确定",cancel:"取消"})},e.pagination=function(t,l,a){e.page=l,e.pageList=Est.getListByPage(t,l,a),e.maxPage=Est.getMaxPage(t.length,a),e.pageNum=Est.getPaginationNumber(parseInt(l),parseInt(e.maxPage),9)},e.pageTo=function(t){e.pagination(e.pic_list,t,e.pageSize)},e.pagePre=function(){e.pageTo(1===e.page?1:--e.page)},e.pageNext=function(){e.pageTo(e.page===e.maxPage?e.maxPage:++e.page)},e.copyImgSrc=function(e){var l=r.open({templateUrl:"modules/Upload/views/copy_src.html",controller:["$scope","$modalInstance",function(l,a){l.pic=e,t.modalInit(l,a,l.pic)}],windowClass:"pic-upload-dialog",resolve:{pic:function(){return e}}});l.result.then(function(){t.showMsg("复制成功")})},e.cate_hover=function(e){return e.show_tool=!e.show_tool},e.pic_hover=function(e){return e.show_tool=!e.show_tool},e.checkbox_checked=function(t,l){return l.stopPropagation(),t.checked?e.checkboxList.splice(Est.indexOf(e.checkboxList,t.att_id),1):e.checkboxList.push(t.att_id),t.checked=!t.checked},e.openGalleryUploadDialog=function(){var l=r.open({templateUrl:"modules/Upload/views/file_upload.html",controller:["$scope","$modalInstance","album_id",function(e,l,a){e.select_list=[],e.albumId=a||null,t.modalInit(e,l,e.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return e.albumId}}});l.result.then(function(){e.folderReFresh()})},e.addAlbumDialog=function(){var l=r.open({templateUrl:"modules/Upload/views/album_add.html",controller:["$scope","$modalInstance","album",function(e,l,a){e.album=a||{},t.modalInit(e,l,e.album)}],windowClass:"pic-upload-dialog",resolve:{album:function(){return{name:"",parent_id:e.albumId}}}});l.result.then(function(t){n.save(t).then(function(){e.refleshAlbum()})})},e.search=function(){return 0===e.searchText.length?void e.folderReFresh():(e.pageList=Est.filter(e.pic_list,function(t){return t.filename.indexOf(e.searchText)>-1}),void(e.pageNum=[1]))}}]),app.controller("uploadPicCtrl",["$scope","$rootScope","API_END_POINT",function(e,t,l){e.openFileDialog=function(e,a){t.openFileDialog(function(t){$("."+e).val(t[0].server_path),void 0!=a&&$("."+a).attr("src",l+t[0].server_path)})}}]),app.controller("FlashUploadCtrl",["$scope","$rootScope","$http","API_END_POINT","AlbumFactory","PictureFactory",function(e,t,l,a,n,o){var r=[{name:"album_id",value:e.albumId}];e.API_END_POINT=a,e.cateName="",e.searchText="",e.loadingFiles=!0,e.albumId="",e.thumb_size={width:80,height:80},e.upload_opts={autoUpload:!0,formData:r,done:function(t,l){l.result[0].thumbnail_path=l.result[0].server_path,e.pic_list.unshift(l.result[0])}},e.get_pic=function(t){e.albumId=t,r[0].value=t,o.query(t,{flash:1}).then(function(t){e.pic_list=t})},e.select_pic=function(t){e.select_list.push(t),e.ok()},e.pic_delete=function(l,a,o){t.open("是否删除该flash？",function(){n.del(e.albumId,l.att_id).then(function(){e.pic_list.splice(a,1)})},{ok:"确定",cancel:"取消"}),o.stopPropagation()},n.query().then(function(t){e.cate_list=t.data,e.get_pic(e.cate_list[0].album_id)}),e.checkbox_checked=function(e,t){return t.stopPropagation(),e.checked=!e.checked}}]),app.run(["$rootScope","$modal",function(e,t){e.openFileDialog=function(l){var a=t.open({templateUrl:"modules/Upload/views/file_upload.html",controller:["$scope","$modalInstance","album_id",function(t,l,a){t.select_list=[],t.albumId=a||null,e.modalInit(t,l,t.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return null}}});return a.result.then(function(e){"undefined"!=typeof l&&l.call(null,e)}),!1},e.openFlashDialog=function(l){var a=t.open({templateUrl:"modules/Upload/views/flash_upload.html",controller:["$scope","$modalInstance",function(t,l){t.select_list=[],e.modalInit(t,l,t.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return null}}});return a.result.then(function(e){"undefined"!=typeof l&&l.call(null,e)}),!1}}]),app.config(["$routeProvider",function(e){e.when("/piece",{templateUrl:"modules/Piece/views/piece.html"})}]),app.config(["$routeProvider",function(e){e.when("/setting",{templateUrl:"modules/Setting/views/setting.html"})}]),app.config(["$routeProvider",function(e){e.when("/style",{templateUrl:"modules/Style/views/style.html"})}]),app.config(["$routeProvider",function(e){e.when("/theme",{templateUrl:"modules/Theme/views/theme.html"})}]),app.config(["$routeProvider",function(e){e.when("/layout",{templateUrl:"modules/Layout/views/layout.html"})}]);var $resourceMinErr=angular.$$minErr("$resource"),MEMBER_NAME_REGEX=/^(\.[a-zA-Z_$][0-9a-zA-Z_$]*)+$/;angular.module("ngAPI",["ng"]).factory("$api",["$http","$q",function(e,t){function l(e){return a(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function a(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function n(e,t){this.template=e,this.defaults=t||{},this.urlParams={}}function o(l,a,p){function m(e,t){var l={};return t=u({},a,t),c(t,function(t,a){d(t)&&(t=t()),l[a]=t&&t.charAt&&"@"==t.charAt(0)?lookupDottedPath(e,t.substr(1)):t}),l}function h(e){return e.resource}function f(e){shallowClearAndCopy(e||{},this)}var _=new n(l);return p=u({},r,p),c(p,function(l,a){var n=/^(POST|PUT|PATCH)$/i.test(l.method);f[a]=function(a,o,r,p){var g,b,I,v={};switch(arguments.length){case 4:I=p,b=r;case 3:case 2:if(!d(o)){v=a,g=o,b=r;break}if(d(a)){b=a,I=o;break}b=o,I=r;case 1:d(a)?b=a:n?g=a:v=a;break;case 0:break;default:throw $resourceMinErr("badargs","Expected up to 4 arguments [params, data, success, error], got {0} arguments",arguments.length)}var w=this instanceof f,E=w?g:l.isArray?[]:new f(g),$={},P=l.interceptor&&l.interceptor.response||h,N=l.interceptor&&l.interceptor.responseError||void 0;c(l,function(e,t){"params"!=t&&"isArray"!=t&&"interceptor"!=t&&($[t]=s(e))}),n&&($.data=g),_.setUrlParams($,u({},m(g,l.params||{}),v),l.url);var U=e($).then(function(e){var t=e.data,a=E.$promise;if(t){if(angular.isArray(t)!==!!l.isArray)throw $resourceMinErr("badcfg","Error in resource configuration. Expected response to contain an {0} but got an {1}",l.isArray?"array":"object",angular.isArray(t)?"array":"object");l.isArray?(E.length=0,c(t,function(e){E.push(new f(e))})):(shallowClearAndCopy(t,E),E.$promise=a)}return E.$resolved=!0,e.resource=E,e},function(e){return E.$resolved=!0,(I||i)(e),t.reject(e)});return U=U.then(function(e){var t=P(e);return(b||i)(t,e.headers),t},N),w?U:(E.$promise=U,E.$resolved=!1,E)},f.prototype["$"+a]=function(e,t,l){d(e)&&(l=t,t=e,e={});var n=f[a].call(this,e,this,t,l);return n.$promise||n}}),f.bind=function(e){return o(l,u({},a,e),p)},f}var r={get:{method:"GET",withCredentials:!0},save:{method:"POST",withCredentials:!0},query:{method:"GET",isArray:!0,withCredentials:!0},remove:{method:"DELETE",withCredentials:!0},"delete":{method:"DELETE",withCredentials:!0}},i=angular.noop,c=angular.forEach,u=angular.extend,s=angular.copy,d=angular.isFunction;return n.prototype={setUrlParams:function(e,t,a){var n,o,r=this,i=a||r.template,u=r.urlParams={};c(i.split(/\W/),function(e){if("hasOwnProperty"===e)throw $resourceMinErr("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(e)&&e&&new RegExp("(^|[^\\\\]):"+e+"(\\W|$)").test(i)&&(u[e]=!0)}),i=i.replace(/\\:/g,":"),t=t||{},c(r.urlParams,function(e,a){n=t.hasOwnProperty(a)?t[a]:r.defaults[a],angular.isDefined(n)&&null!==n?(o=l(n),i=i.replace(new RegExp(":"+a+"(\\W|$)","g"),o+"$1")):i=i.replace(new RegExp("(/?):"+a+"(\\W|$)","g"),function(e,t,l){return"/"==l.charAt(0)?l:t+l})}),i=i.replace(/\/+$/,"")||"/",i=i.replace(/\/\.(?=\w+($|\?))/,"."),e.url=i.replace(/\/\\\./,"/."),c(t,function(t,l){r.urlParams[l]||(e.params=e.params||{},e.params[l]=t)})}},o}]);